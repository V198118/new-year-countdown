<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Таймер до Нового Года</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            width: 4320px;
            height: 908px;
            overflow: hidden;
            position: relative;
            font-family: 'Arial', sans-serif;
            background: #000;
        }
        
        /* Видео-фон */
        #video-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 1;
        }
        
        /* Затемнение фона для контраста */
        #overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, var(--overlay-opacity, 0.3));
            z-index: 2;
            transition: background-color 0.5s;
        }
        
        /* Контейнер таймера */
        #countdown-container {
            position: absolute;
            z-index: 3;
            left: var(--timer-left, 50%);
            top: var(--timer-top, 50%);
            transform: translate(-50%, -50%);
            text-align: center;
            padding: 20px;
            min-width: 1500px;
        }
        
        #countdown {
            display: flex;
            gap: 40px;
            justify-content: center;
            align-items: center;
        }
        
        .time-unit {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 300px;
        }
        
        .time-value {
            font-size: var(--font-size, 200px);
            font-weight: bold;
            line-height: 1;
            color: var(--timer-color, #ffffff);
            text-shadow: 
                3px 3px 10px rgba(0, 0, 0, 0.8),
                0 0 20px rgba(255, 255, 255, 0.3);
            letter-spacing: 2px;
            font-family: 'Courier New', monospace;
        }
        
        .time-label {
            font-size: calc(var(--font-size, 200px) * 0.25);
            color: var(--label-color, #ffffff);
            margin-top: 15px;
            text-transform: uppercase;
            letter-spacing: 3px;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.7);
            opacity: 0.9;
            font-weight: bold;
        }
        
        .separator {
            font-size: calc(var(--font-size, 200px) * 0.7);
            color: var(--timer-color, #ffffff);
            margin: 0 10px;
            line-height: 1;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.9);
            font-weight: bold;
        }
        
       
    
        
        /* Индикатор настроек */
        #config-indicator {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0);
            color: #4CAF50;
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 14px;
            z-index: 100;
            display: none;
        }
    </style>
</head>
<body>
    <!-- Видео-фон -->
    <video id="video-background" autoplay muted loop playsinline>
        <source src="background.mp4" type="video/mp4">
        <source src="background.webm" type="video/webm">
        Ваш браузер не поддерживает видео.
    </video>
    
    <!-- Затемнение для контраста -->
    <div id="overlay"></div>
    
    <!-- Контейнер таймера -->
    <div id="countdown-container">
        <div id="countdown">
            <div class="time-unit">
                <div id="hours" class="time-value">000</div>
                <div class="time-label">часов</div>
            </div>
            <div class="separator">:</div>
            <div class="time-unit">
                <div id="minutes" class="time-value">00</div>
                <div class="time-label">минут</div>
            </div>
            <div class="separator">:</div>
            <div class="time-unit">
                <div id="seconds" class="time-value">00</div>
                <div class="time-label">секунд</div>
            </div>
        </div>
    </div>
    
    <!-- Ссылка на страницу настроек -->
    <a href="config.html" id="settings-link" target="_blank">⚙️ Настройки</a>
    
    <!-- Индикатор применения настроек -->
    <div id="config-indicator">Настройки применены ✓</div>

    <!-- Подключение скриптов -->
    <script src="config.js"></script>
    <script>
        // Основной скрипт таймера (формат: часы:минуты:секунды)
        function updateCountdown() {
            const now = new Date();
            const currentYear = now.getFullYear();
            
            // Дата следующего Нового года
            let newYearDate = new Date(currentYear + 1, 0, 1, 0, 0, 0, 0);
            let diff = newYearDate - now;
            
            // Если Новый год уже прошел, берем следующий год
            if (diff < 0) {
                newYearDate = new Date(currentYear + 2, 0, 1, 0, 0, 0, 0);
                diff = newYearDate - now;
            }
            
            // Вычисляем общее количество часов, минут, секунд
            const totalSeconds = Math.floor(diff / 1000);
            const totalHours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = Math.floor(totalSeconds % 60);
            
            // Обновляем отображение
            document.getElementById('hours').textContent = 
                totalHours.toString().padStart(3, '0').slice(-3); // Максимум 999 часов
            document.getElementById('minutes').textContent = 
                minutes.toString().padStart(2, '0');
            document.getElementById('seconds').textContent = 
                seconds.toString().padStart(2, '0');
            
            // Если часов больше 999, показываем 999
            if (totalHours > 999) {
                document.getElementById('hours').textContent = '999';
            }
        }
        
        // Применение настроек из конфигурации
        function applyConfig() {
            const container = document.getElementById('countdown-container');
            const overlay = document.getElementById('overlay');
            const root = document.documentElement;
            
            if (window.timerConfig) {
                const config = window.timerConfig;
                
                // Применяем позицию
                container.style.left = config.position.left;
                container.style.top = config.position.top;
                
                // CSS переменные
                root.style.setProperty('--timer-left', config.position.left);
                root.style.setProperty('--timer-top', config.position.top);
                root.style.setProperty('--font-size', config.fontSize + 'px');
                root.style.setProperty('--timer-color', config.color);
                root.style.setProperty('--label-color', config.labelColor);
                root.style.setProperty('--overlay-opacity', config.overlayOpacity || 0.3);
                
                // Затемнение фона
                overlay.style.backgroundColor = `rgba(0, 0, 0, ${config.overlayOpacity || 0.3})`;
                
                // Показываем индикатор применения настроек
                const indicator = document.getElementById('config-indicator');
                indicator.style.display = 'block';
                setTimeout(() => {
                    indicator.style.display = 'none';
                }, 3000);
            }
        }
        
        // Инициализация
        document.addEventListener('DOMContentLoaded', function() {
            // Загружаем настройки
            loadConfig();
            
            // Применяем настройки
            applyConfig();
            
            // Настраиваем видео
            setupVideo();
            
            // Запускаем таймер
            updateCountdown();
            setInterval(updateCountdown, 1000);
            
            // Слушаем изменения в localStorage (для обновления настроек в реальном времени)
            window.addEventListener('storage', function(e) {
                if (e.key === 'timerConfig') {
                    loadConfig();
                    applyConfig();
                }
            });
            
            // Также проверяем изменения каждые 2 секунды (на случай если страница настроек открыта в этом же браузере)
            setInterval(function() {
                const savedConfig = localStorage.getItem('timerConfig');
                if (savedConfig && JSON.stringify(window.timerConfig) !== savedConfig) {
                    loadConfig();
                    applyConfig();
                }
            }, 2000);
        });
        
        // Загрузка конфигурации
        function loadConfig() {
            const savedConfig = localStorage.getItem('timerConfig');
            if (savedConfig) {
                try {
                    window.timerConfig = JSON.parse(savedConfig);
                } catch (e) {
                    console.error('Ошибка загрузки конфигурации:', e);
                    // Используем конфиг по умолчанию
                    if (window.defaultConfig) {
                        window.timerConfig = window.defaultConfig;
                    }
                }
            } else if (window.defaultConfig) {
                window.timerConfig = window.defaultConfig;
            }
        }
        
        // Настройка видео
        function setupVideo() {
            const video = document.getElementById('video-background');
            
            // Пытаемся запустить автовоспроизведение
            const playPromise = video.play();
            if (playPromise !== undefined) {
                playPromise.catch(error => {
                    console.log('Автовоспроизведение видео заблокировано');
                });
            }
        }
    </script>
</body>
</html>
